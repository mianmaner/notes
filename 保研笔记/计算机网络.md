#### 引言

##### 1. 网络实例

网络分类：
① 个域网 PAN：小范围
② 局域网 LAN：区域网络
③ 城域网 MAN：覆盖一个城市的网络

互联网构成：
① 网络边缘（端系统）
② 网络核心

典型交换方式：
① 电路交换
② 报文交换
③ 分组交换

##### 2. 协议与分层结构

网络协议：为进行网络中的数据交换而建立的规则、标准或约定，即网络协议

网络协议三要素：
①语法：规定传输数据的格式
②语义：规定所要完成的功能
③时序：规定各种操作的顺序

协议分层结构：
<img src="https://gitee.com/mianmann/drawing-bed-warehouse/raw/master/img/image-20230911162621055.png" alt="image-20230911162621055" style="zoom:50%;" />

> 协议：相同层之间通信规则的集合
> 接口：相邻两层之间交换信息的连接点
> 服务：下层为紧邻上层提供的功能调用

六个核心服务原语：连接请求、接受响应、请求数据、应答、请求断开、断开连接

##### 3. 参考模型

**OSI 模型**：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层

> 物理层：定义如何在信道上传输 0、1
> 数据链路层：实现相邻网络实体间的数据传输
> 网络层：将数据包跨越网络从源设备发送到目标设备
> 传输层：将数据从源端口发送到目的端口
> 会话层：利⽤传输层提供的服务，在应⽤程序之间建⽴和维持会话
> 表示层：管理数据的表示⽅法、传输数据的数据结构
> 应用层：通过应⽤层协议，提供应⽤程序便捷的⽹络服务调⽤

> 为何在唯一的MAC地址外，还需要唯一的IP地址？
> 答：和MAC不同的是，IP地址是和地域相关的。对于位于同一个子网上的设备,我们给他们分配的IP 地址前缀都是一样的，这个前缀就像邮政编码一样。这样，路由器过IP地址的前缀就能知道这个设备在哪个子网上了。现在,路由器只需要记住每个子网的位置即可，大大减少了路由器所需要的内存。

**TCP/IP 参考模型**：应用层、传输层、互联网层、网络接口层

> 网络接口层：为满足无连接的互联网络层需求，链路必须具备的功能
> 互联网层：允许主机将数据包注⼊⽹络，让这些数据包独⽴的传输⾄⽬的地，并定义了数据包格式和协议（IPv4 协议和 IPv6 协议）
> 传输层：允许源主机与⽬标主机上的对等实体，进⾏端到端的数据传输
> 应用层：传输层之上的所有高层协议

##### 4. 网络度量单位

① 比特率：主机在数字信道上传送数据的速率，也称数据率
② 带宽：网络中某通道传送数据的能力，即单位时间内网络中的某信道所能通过的最高数据率
③ 时延：总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延
④ 往返时延 RTT：从发送⽅发送数据开始，到发送⽅收到来⾃接收⽅的确认，经历的总时间
⑤ 时延带宽积：时延带宽积 = 传播时延$\times$带宽，即按⽐特计数的链路⻓度

##### 5. 网络安全与威胁

病毒：需要某种形式的⽤户交互来不断传播的恶意软件
蠕虫： ⼀种⽆须⽤户明显交互即可运⾏和传播的独⽴程序

#### 物理层

##### 1. 物理层

位置：物理层是网络体系结构中的最低层（不是具体的物理设备或媒体）
功能：在连接个计算机的传输媒体上传输数据比特流

##### 2. 接口特性

① 机械特性：涉及接⼝的物理结构，通常采⽤接线器来实现机械上的连接
② 电气特性：规定了DTE/DCE之间多条信号线的电⽓连接及有关电路特性
③ 功能特性：描述接⼝执⾏的功能，定义接线器的每⼀引脚的作⽤
④ 过程特性：指明对于不同功能的各种可能事件的出现顺序

##### 3. 传输介质

导引型传输介质：指电磁波被导向沿着某一媒体传播（双绞线、同轴电缆、光纤）

非导引型传输介质：指电磁波在大气层、外层空间或海洋中进行的无线传播（短波传输、散射传输、地面微波、光波传输）

##### 4. 多路复用技术

复用技术的目的是：允许用户使用一个共享信道进行通信，避免相互干扰，降低成本，提高利用率

① 频分复用（FDM）：是⼀种将多路基带信号调制到不同频率载波上，再进⾏叠加形成⼀个复合信号的多路复⽤技术
② 时分复用（TDM）：将时间划分为一段段等长的时分复用帧
③ 波分复用（WDM）：利用多个激光器在单条光纤上同时发送多束不同波长激光的技术
④ 码分复用（CDMA）：如码分多址为每个信道分配一个正交的码片序列（由多个+1、-1 构成）作为地址，通过与广播中的码片做内积可以还原出信息

#### 数据链路层

##### 1. 数据链路层

① 向下：利用物理层提供的位流服务
② 向上：向网络层提供明确的服务接口

##### 2. 功能

① 成帧：将⽐特流划分成帧，主要⽬的是为了检测和纠正物理层在⽐特传输中可能出现的错误
② 差错控制：处理传输中出现的差错
③ 流量控制：确保发送方的发送速率，不大于接收方的处理速率

##### 3. 差错控制

**检错码**

在被发送的数据块中，包含⼀些冗余信息，但这些信息只能使接收⽅推断是否发⽣错误，但不能推断哪位发⽣错误，接收⽅可以请求发送⽅重传数据

① 奇偶校验：1位奇偶校验是最简单、最基础的检错码（奇校验：保证1的个数为奇数个）
② 校验和：主要用于TCP/IP体系中的网络层和传输层（16 进制反码求和运算结果全为1）
③ 循环冗余校验 CRC：数据链路层广泛使用的校验方法

**纠错码**

发送⽅在每个数据块中加⼊⾜够的冗余信息，使得接收⽅能够判断接收到的数据是否有错，并能纠正错误（定位出错的位置）

海明码：
<img src="https://gitee.com/mianmann/drawing-bed-warehouse/raw/master/img/image-20231016170905530.png" alt="image-20231016170905530" style="zoom: 40%;" />

> 海明距离：两个码字之间不同对应比特的数目

> 二进制卷积码、里德所罗门码等

##### 4. 数据链路层协议

乌托邦式单工协议：数据单向传输、一切完美

停止等待协议：发送方发送一帧后暂停，接收方完成接收后回复确认接收，发送方收到确认后再发送下一帧

**滑动窗口协议**

发送窗口：表示在收到对方确认的信息钱，可以连续发出的最多数据帧数
接收窗口：为可以连续接收的最多数据帧数

确认的方式有两种，划分出了下面两个协议：

① 回退 N 协议：当接收端收到一个出错帧或乱序帧时，丢弃所有的后继帧，并且不为这些帧发送确认。发送端超时后，重传所有未被确认的帧

② 选择重传协议：若发送方发出连续的若干帧后，收到对其中某一帧的否认帧，或某一帧的定时器超时，则只重传该出错帧或计时器超时的数据帧

##### 5. 介质访问子层 MAC

数据链路层分为两个子层：链路控制子层 LLC 和介质访问子层 MAC

**信道分配问题**

信道：信号的通道
常见的局域网拓扑：总线拓扑、星型拓扑、环型拓扑（共同点：共享一根信道）

**多路访问协议**

ALOHA 协议：发送数据前不检测冲突直接发送，一段时间没有收到确认即认为发生冲突，等待随机的时间后重新发送数据

分隙 ALOHA 协议：划分时间槽，发送数据不检测冲突，在时间槽开始时开始发送，一个时间槽内发送完一帧，同样的一段时间没有收到确认即认为发生冲突，等待随机数量的时间槽后重新发送数据

CSMA 协议：
① 非持续型：发送数据前侦听信道，若信道空闲则发送，若信道忙则放弃侦听，等待随机时间后再次侦听
② 1-持续型（CSMA/CD）：发送数据前侦听信道，若信道空闲则发送，若信道忙则持续侦听至信道空闲后发送
③ p-持续型：适用于分时间槽的信道。发送数据前侦听信道，若信道空闲，则以概率 p 发送数据，以概率（1-p）推迟到下一个时间槽，在下一个时间槽重复此判断

**受控访问协议**

位图协议、令牌传递、二进制倒数协议

##### 6. 以太网

**以太网类型**

① 经典以太网：最高速率 10 Mbps，使用曼彻斯特编码，使用同轴电缆和中继器连接
② 交换式以太网：带宽10 Mbps，使用集线器，核心是交换机
③ 快速以太网：带宽 100 Mbps
④ 千兆以太网：带宽 1000 Mbps
⑤ 万兆以太网：带宽 10000 Mbps

**MAC 帧**

MAC 帧格式：
<img src="https://gitee.com/mianmann/drawing-bed-warehouse/raw/master/img/image-20231030172156742.png" alt="image-20231030172156742" style="zoom:40%;" />

MAC 地址表进行数据帧转发的三种情况：转发、过滤、泛洪

> 两种目的地址的帧需要泛洪：①广播帧 ②未知单播帧

> 无线局域网：指以无线信道作为传输介质的计算机局域网

#### 网络层

##### 1. 网络层服务

网络层的工作设备是路由器，隔离广播域

网络层的功能：
① 路由：选择数据包从源端到目的端的路径
② 转发：将数据包从路由器的输入接口传送到正确的输出接口

提供给传输层的服务：由网络或端系统来负责，面向连接（虚电路）或无连接（数据包）

##### 2. IPv4 协议

IPv4 协议是一种无连接的协议

Internet 协议执行两个基本功能：寻址、分片

IPv4 数据包格式：
![image-20231113172548656](https://gitee.com/mianmann/drawing-bed-warehouse/raw/master/img/image-20231113172548656.png)
![image-20231113172618466](https://gitee.com/mianmann/drawing-bed-warehouse/raw/master/img/image-20231113172618466.png)

**IP 地址（网络号+主机号）**

IP 地址共分为 A 至 E 五类，其中 A 类、B 类、C 类为单播地址
① A 类：$1.0.0.0\sim 127.255.255.255$
② B 类：$128.0.0.0\sim 191.255.255.255$
③ C 类：$192.0.0.0\sim 223.255.255.255$

特殊 IP 地址：
① 全 0 网络地址：又叫主机地址
② 127 开头地址：本地节点
③ 全 0 主机地址：又叫网络地址或网络号
④ 全 1 主机地址：用于广播
⑤ 0.0.0.0：指任意地址
⑥ 255.255.255.255：用于本地广播

**子网划分**

子网掩码：置 1 表示网络位，置 0 表示主机位

通过子网掩码确定 IP 地址的前缀，包括网络号和子网号，网络号对应上述的地址划分

**无类域间路由（CIDR）**

指定网络号的位数，地址格式例如 194.24.0.0/21 中的 21 为网络号的位数。寻址时按照最长匹配前缀，寻址网络号最长的能够匹配的网络。主机号不能全 0 或全 1

**ARP 地址解析**

主机的 ARP 表为 IP 地址和 MAC 地址的对应关系，如果没有则通过广播发现并添加

> 交换机中的转发表为MAC地址和端口号的对应关系

MAC 地址在经过网络设备时，源 MAC 地址和目的 MAC 地址都会变化，但 IP 地址是不变的

**网络地址转换（NAT）**

网络地址转换（NAT）用于解决IPv4地址不足的问题，是一种将私有（保留）地址转化为公有 IP 地址的转换技术

利用 NAT 转换表映射：局域网地址及端口 <-> 广域网地址及端口

**DHCP 动态主机配置协议**

给主机动态地分配 IP 地址，工作在应用层，使用 UDP 协议

工作模式：客服/服务器模式（C/S）

工作过程：
① DHCP 客户从 UDP 端口 68 以广播形式向服务器发送发现报文（DHCP DISCOVER)
② DHCP 服务器以广播形式发出提供报文（DHCP OFFER)
③ DHCP 客户从多个 DHCP 服务器中选择一个，并向其以广播形式发送 DHCP 请求报文（DHCP REQUEST)
④ 被选择的DHCP服务器以广播形式发送确认报文（DHCP ACK)

**ICMP 协议**

网际控制报文协议，是 IP 层协议，分为 ICMP 差错报告报文和 ICMP 询问报文

`ping` 命令：用来测试两个主机之间的连通性

`traceroute` 命令：用来获取整个路径上路由器的地址

##### 3. 路由算法与路由协议

**距离矢量路由算法和 RIP 协议**

每个路由器维护一张路由表，路由器周期性地向其相邻路由器广播自己知道的路由信息，相邻路由器可以根据收到的路由信息修改和刷新自己的路由表，路由器经过若干次更新后，最终都会知道到达所有网络的最短距离

RIP 是应用层协议，使用 UDP

**链路状态路由算法和 OSPF 协议**

所有人先将自己的已知邻居信息公布，然后 Dijkstra 算法

OSPF 是网络层协议，直接使用 IP 数据报传输数据

**层次路由与 BGP 协议**

一个自治系统内部使用的路由协议称为内部网关协议 IGP，可以使用 RIP 或 OSPF。自治系统之间使用的协议是外部网关协议 EGP 或边界网关协议 BGP

BGP 协议是应用层协议，使用 TCP

#### 传输层

##### 1. 传输层

传输层的功能：提供进程间的逻辑通信、复用与分用（使用端口地址区分进程）、差错控制

进程之间在网络中的通信使用套接字，为（主机 IP 地址，端口号）

##### 2. 复用与分用

复用（发送端）：传输层从多个套接字收集数据，交给网络层发送
分用（接收端）：传输层从网络层收到的数据，交付给正确的套接字

UDP 套接字要用（IP 地址，端口号）二元组进行标识
TCP 套接字分为监听套接字和连接套接字，连接套接字要用（源 IP 地址，目的 IP 地址，源端口号，目的端口号）四元组进行标识

##### 3. UDP 协议

无连接传输，使用报文总长度和校验和来检测报文错误（只能检测错误不能纠错）

##### 4. TCP 协议

面向连接传输

接收方：累计确认，若出现错误则重复前一次的确认序号
发送方：仅对最早未确认的报文段使用一个重传定时器

**TCP 连接**

称为三次握手：

① 客户机主动打开端口，发送连接请求报文，SYN=1，ACK =0，seq = x；
② 服务器收到请求后，如果同意连接，为此连接分配 TCP 缓存和变量，发送连接确认报文，SYN=1，ACK=1，seq = y，ack =x+1；
③ 客户机收到确认报文后，分配 TCP 缓存和变量，想服务器确认，SYN=0，ACK=1，seq=x+1，ack=y+1。

TCP 连接释放（两次握手）：释放连接请求+确认

快速重传：收到三次重复确认，重发报文段

**TCP 流量控制**

发送方根据接收方的接收窗口 rwind 和网络的拥塞窗口 cwind 中最小的，决定发送数据的多少。rwind 由接收方的缓存决定，cwind 由拥塞控制决定

TCP 拥塞控制实际是维护 cwind 的大小

策略：低于阈值时慢启动（每经过一个 RTT，将 cwind 加倍），超过阈值后乘性减（检测到丢包后将 cwind 大小减半）、加性增（每经过一个 RTT，将 cwind 增大一个 MSS）

#### 应用层

##### 1. 应用进程通信方式

① 客户/服务器（C/S 方式）
② 浏览器/服务器（B/S 方式）
③ 对等（P2P）方式：两个进程在通信时不区分服务的请求方和服务的提供方

##### 2. 域名系统 DNS

工作在 UDP 协议之上，端口号 53。

一共有 13 个根域名服务器，用于管辖顶级域名；下面是顶级域名服务器、授权域名服务器、本地域名服务器。

域名解析过程：递归查询和迭代查询

##### 3. 电子邮件系统 

SMTP 协议、POP3 协议、IMAP 协议，三个协议都是基于TCP连接的

##### 4. 其他协议

Telnet：远程登录协议，TCP 实现
FTP：文件传输协议，TCP  实现
SNMP：网络管理协议，UDP 实现
