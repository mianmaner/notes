#### 第一章、概述

##### 一、计算机系统简介

##### 二、计算机的基本组成

1.冯$\vdot$诺依曼计算机（存储式计算机）
(1)特点：
①由运算器、存储器、控制器、输入设备和输出设备五大部件组成
②指令和数据以同等地位存放于存储器内，可按地址寻访
③指令和数据均用二进制表示
④指令由操作码和地址码组成，操作码表示操作的性质，地址码表示操作数在存储器中的位置
⑤指令在存储器中按顺序存放、顺序执行
⑥以运算器为中心，存储器和输入输出设备之间的数据传送经由运算器

(2)各个部件的作用：
①输入设备：将人熟悉的信息形式转换成及其能识别的形式
②存储器：存放数据和程序
③运算器：算术运算、逻辑运算
④控制器：控制程序的输入、运行及处理结果
⑤输出设备：将结果转换成人们熟悉的形式

2.计算机硬件框图

(1)以存储器为中心的计算机
<img src="https://s2.loli.net/2023/07/31/dPa31erhkvDn7YA.png" alt="image-20230601202019470" style="zoom:50%;" />

(2)现代计算机
①现代计算机由CPU、主存和I/O设备组成（其中CPU和主存储器合起来称为主机）
②CPU：ALU（运算器）和   CU（控制器）
<img src="https://s2.loli.net/2023/07/31/Q5vmDjaUq8gHxbu.png" alt="image-20230601220908927" style="zoom: 67%;" />

3.计算机的工作过程

(1)主存储器的基本组成：存储体、MAR、MDR

(2)控制器的基本组成：CU、IR、PC

(3)运算器的基本组成：ACC、MQ、ALU、X

(2)存储字长：存储单元中二进制代码的位数，通常取8的倍数
机器字长：CPU一次能处理数据的位数，与CPU中的寄存器位数有关
指令字长：取决于操作码的长度、操作数地址的长度、操作数地址的个数

#### 第三章、系统总线

##### 一、总线的基本概念

1.为什么要使用总线：
①五大部件之间需要信号连接通路
②两种连接方式：分散连接连线十分复杂，且不能解决I/O设备和主机之间连接的灵活性，而总线连接能够满足随时增减设备的需要

2.什么是总线：总线是连接多个部件的公共信息传输线，是各个部件共享的传输介质

3.总线上的信息传送：总线中可以包含多条传输线路，可以一条数据线传递信息（串行），也可以多条线一起传输信息（并行）

##### 二、总线的分类

1.按照数据传送方式：串行传输总线、并行传输总线
（并行传输总线又可以分为8/16/32/64位传输总线）

2.按照总线使用范围：计算机总线、测控总线、网络通信总线

3.按照连接部件层次的不同：片内总线、系统总线、通信总线

(1)片内总线：芯片内部的总线

(2)系统总线：计算机各大部件之间的信息传输线
①数据总线：在部件之间传输数据信息，双向总线
②地址总线：指出CPU将访问的数据所在存储单元或者I/O设备的地址，单向输出总线
③控制总线：各种控制信号的传输线，有出有入

(3)通信总线：用于计算机系统之间或计算机系统与其他系统之间的通信，总线种类很多，差别很大
①串行通信总线：速度慢、距离远、造价sa低
②并行通信总线：速度快、距离近、造价高

##### 三、总线特性和性能指标

1.总线特性：机械特性、电气特性、功能特性、时间特性

2.总线的性能指标
①总线宽度：总线中数据总线的根数，如16位、32位等
②总线带宽（数据传输率）：每秒传输的最大字节数
③时钟同步/异步：总线上数据与时钟同步/不同步工作
④总线复用：一种信号线上分时传送两种信号，地址线和数据线共用一组线路，分时传送地址/数据
⑤信号线数：地址线、数据线和控制线的总线数
⑥总线控制方式
⑦其他指标

==（计算题）==
<img src="https://s2.loli.net/2023/07/31/gFTwMqKvidzecUZ.png" alt="image-20230602102303556" style="zoom:50%;" />
<img src="https://s2.loli.net/2023/07/31/vSnY9TygMGmRHB2.png" alt="image-20230602102329887" style="zoom:50%;" />

##### 四、总线控制

1.总线控制

(1)总线判优控制：如果多个主设备同时要使用总线，就由总线控制器的判优、仲裁逻辑按照一定的优先等级顺序，确定哪个主设备能使用总线

> 总线上的各类设备可分为：主设备（对总线有控制权），从设备（无总线控制权）

①集中式：将控制逻辑集中在一处

- 链式查询方式
  a.只需要3根控制线，就能按照一定优先级次序实现总线控制 
  b.离总线控制部件最近的I/O设备具有最高优先级
  c.容易扩充设备、对电路故障敏感
  d.优先级固定，优先级低的设备难以获得请求
- 计算机定时查询方式
  a.优先级有很多可能：
  固定——计数每次从0开始
  循环——每次计数从上一次计数的终点开始
  可变——计数器初值由程序设定
  b.对电路故障不敏感
  c.增加了控制线数量，需要$log_2n$根设备地址线为设备设备数量
  d.控制更为复杂
- 独立请求方式
  a.响应速度快，因为BG信号与设备一一对应
  b.优先级次序控制灵活
  c.增加了控制线数量（2n根），控制比较复杂

②分布式：将控制逻辑分散在与总线连接的各个部件或设备上

(2)总线通信控制

①总线周期：设备完成一次总线操作所用的时间
（申请分配阶段、寻址阶段、传数阶段、结束阶段）

②四种方式：同步通信、异步通信、半同步通信、分离式通信

- 异步通信的数据传送速率
  波特率：单位时间内传送的二进制数据的位数，单位bps(位/秒)
  比特率：异步串行通信单位时间内传送的二进制有效数据的位数，单位：bps(位/秒)

==（计算题）==
<img src="https://s2.loli.net/2023/07/31/DGjb3zEORVNIic4.png" alt="image-20230602102457112" style="zoom:50%;" />

#### 第四章、存储器

##### 一、概述

1.存储器的分类

(1)按存储介质分类：半导体存储器、磁表面存储器、磁芯存储器、光盘存储器

(2)按存储方式分类：

①存储时间与物理地址无关（随机访问）
随机存储器RAM：在程序执行过程中可读可写，用作主存
只读存储器ROM：在程序执行过程中只读，存放固定内容

②存储时间与物理地址有关（串行访问）

(3)按在计算机中的作用分类：

①主存储器：分为RAM和ROM，RAM又分为动态RAM和静态RAM
②高速缓冲存储器（Cache）：缓存是静态RAM，用于速度不同的CPU/主存之间作为缓冲
③辅助存储器：存放暂时不用的内容，不能与CPU直接交换信息

2.存储器的层次结构

(1)存储器有三个主要性能指标：速度、容量、价格/位

(2)存储器架构图
<img src="https://s2.loli.net/2023/07/31/lN4H1boRa3XQntJ.png" alt="image-20230603144420537" style="zoom:50%;" />
(从上往下，CPU的访问频率越来越低；寄存器中的数在CPU内部参与计算，主存存放将要参与运行的程序和数据，现代计算机把缓存制作在CPU内部)

==(3)缓存-主存层次和主存-辅存层次==

①CPU的层次结构主要体现在缓存-主存和主存-辅存两个存储层次上
②CPU和缓存、主存都能交换信息，缓存可以和CPU、主存交换信息，主存和CPU、主存、辅存都能交换信息，辅存只能和主存交换信息
③缓存-主存层次解决了CPU和主存速度不匹配的问题，缓存-主存层次的速度接近于缓存，容量、价位接近于主存。
④主存-辅存层次解决了存储系统容量的问题，速度接近于主存，容量、价位接近辅存。

3.程序访问的局部性：程序执行时对存储器的访问是不均匀的

##### 二、主存储器

1.主存储器的结构：存储体—MAR（地址寄存器）—MDR（存储数据寄存器）

2.技术指标==（计算题）==

(1)计算机系统访问主存时，一般可以字寻址或者字节寻址，n根地址总线默认对应$2^n$个字节

(2)存储容量
主存存放二进制代码的总位数=存储单元个数*存储字长
总字节数=总位数/8

(3)存储速度
①存取时间：启动一次存储器读或写操作到完成该操作所需的全部时间
②存取周期：存储器进行连续两次独立的存储器操作所需的最小时间间隔

(存取周期=存取时间+恢复时间)

(存取周期和存取时间的关系，类似总线周期和总线传输周期)

(4)存储器带宽
①衡量数据传输速率的技术指标
②表示单位时间内存储器存取的信息量（单位有：字/秒、字节/秒、位/秒）
③为了提升存储器带宽，可以缩短存储周期，增加存储字长

##### 三、随机存取存储器（RAM）

1.按照存储信息的原理可分为静态RAM（以触发器原理寄存信息)和动态RAM（以电容充放电原理寄存信息）

2.动态RAM的刷新

(1)刷新周期一般取2ms，逐行刷新，刷新一行用时一个存取周期

(2)分类：
①集中刷新
②分散刷新
③异步刷新（分散刷新与集中刷新相结合）

##### 四、只读存储器（ROM）

==(ROM一般用于系统程序，RAM用于用户程序)==

##### ==五、存储器与CPU的连接==                                                                                                                                                                                                                                                                                                                                                                                             

1.半导体存储芯片
![img](https://s2.loli.net/2023/07/31/s1ZfjNyVcA4gaTh.png)
①地址线（单向）传递数据存放的地址信息，其宽度/根数 代表了该存储矩阵中存储单元的数量，也就是能存储多少信息。
②数据线（双向）传递数据 。 其宽度/根数代表一次可以传递多少位信息。
③读/写控制线：控制数据是读入还是写出。若是一根线WE表示：低电平写，高电平读。若是两根线通常会出现‘OE’字样。此时‘OE’表示允许读，‘WE’表是允许写。
④片选线：一个存储设备（比如说内存条)上是存在很多个存储芯片，该线选择在哪一个芯片上存储。（CS：片选信号，低电平有效)

2.存储器容量的扩展

(1)位扩展（增加存储字长）
用两片1K×4位存储芯片组成1K×8位的存储器
<img src="https://s2.loli.net/2023/07/31/kIr6pcOj4CmzXR5.png" alt="image-20230603160824236" style="zoom: 67%;" />
①位扩展，就是增加存储字长，如上图所示：2片1K×4位的存储芯片组成1K×8位的存储器。这里的1K就是$2^{10}$,所以地址线是10根；8位字长是有8根数据线。
②原图中一个2114存储芯片只接4根地址线，两个就是8根，扩充了数据位。两个芯片的片选线和读写线连接在一起，代表同时选中。

(2)字扩展（增加存储字的数量）
用两片1K×8位存储芯片组成2K×8位的存储器<img src="https://s2.loli.net/2023/07/31/wi7puTaXhxzHQLD.png" alt="image-20230603161350686" style="zoom: 50%;" />

①上图所示：2片1K×8位的存储芯片组成2K×8位的存储器。2K就是$2^{11}$,所以地址线是11根 (这里需要说明，多出来的地址线为片选线留的。实际上各个芯片只连10根地址线)；数据线都是8根。
②字扩展的片选线连接需要十分注意一下。我们可以看到$A_{10}$上有个判断器。若$A_{10}=1$时，选择$CS_0$第一个芯片。通过非门，也就是$A_{10}=0$，则是第二个芯片被选中。

(3)字、位扩展
用8片1K×4位存储芯片组成4K×8位的存储器
<img src="https://s2.loli.net/2023/07/31/NkiJfLA6Mu5hsEC.png" alt="image-20230603161652469" style="zoom:50%;" />
①同时扩展就是位扩展和字扩展同时进行。这个好理解。上图先通过位扩展将2片1K×4位合成1K×8位的整体。再通过字扩展使用4个整体构造4K×8位的存储器。
②由于地址线多出连两条，作为片选线使用。通过2位二进制数就可以区分四个部分。00、01、10、11代表片选线$CS_{0、1、2、3}$

3.实例题

==(1)根据实例题分析学会画逻辑图：https://blog.csdn.net/m0_50808748/article/details/129212653）==

(2)题目有时不给出内存工作区地址边界代码，而是给出起始或终止地址以及该区容量（空间大小），这时首先要写出地址边界代码：
①终止地址 = 起始地址 + 空间大小 - 1
②起始地址 = 终止地址 - 空间大小 + 1

##### 六、存储器的校验

1.编码的最小距离：编码的纠错、检错能力与编码的最小距离有关，编码最小距离是指在编码系统内，任意两组合法代码之间的最少二进制位数的差异

2.==汉明码：==是一种具有纠错能力的编码

(1)汉明码的组成：原始代码+检测位

(2)各检测位的检测小组：
①$C_1$检测的$g_1$小组包含：$1,3,5,7\cdots$
②$C_2$检测的$g_2$小组包含：$2,3,6,7\cdots$
③$C_3$检测的$g_3$小组包含：$4,5,6,7\cdots$

(3)增添的检测位数$k$根据$2^k\ge n+k+1$得出

(4)例题：见书P101、P102

##### 七、高速缓冲存储器

1.由于缓存容量远小于主存容量，任何时候都只有一部分主存块位于缓存中，CPU要从主存中读取一个字时，有两种可能：
①如果所需的字已在Cache中，则直接从Cache中取走，这称为CPU访问Cache命中
②如果所需的字不在Cache中，这称为CPU访问Cache不命中，这种情况从主存取字，并将该字所在的主存块调入缓存中

2.主存-缓存之间的传送
①如果某主存块的内容已经调入相应的缓存块，则称该主存块与缓存块建立了对应关系
②主存和Cache之间是字块传送，主存字块调入Cache时，不是在任意字块位置都可以存放

3.主存-缓存地址映射：CPU访存时，给出的是存储字的主存地址（含主存块地址与块内地址），基于此，地址映射变换机构找到存储字所在主存块对应的Cache块

(1)直接映射：每个主存块只能与固定的一个缓存块对应，每个缓存块可以和多个主存块对应。若主存块数为64，缓存块数是8，则第1号缓存块对应1, 9, 17, 25, 33, 41, 49, 57号主存块:1+8*n
(主存字块标记   缓存字块地址   字块内地址)

(2)全相联映射：最灵活、Cache空间利用最充分的映射方式，多对多的关系（主存中的任一块可以映射到缓存中的任一块）
(主存字块标记   字块内地址)

(3)组相联映射：对应某一分组的主存块可以映射到该组内任一块，n路组相联表示Cache组内由n个字块
(主存字块标记   组地址   字块内地址)

==例题（貌似说过要考）==

<img src="https://s2.loli.net/2023/07/31/dphDVuqXkiwFlzC.png" alt="image-20230610154625515" style="zoom:50%;" />
<img src="https://s2.loli.net/2023/07/31/LE7v8WHriJDZVh2.png" alt="image-20230610154640863" style="zoom:50%;" />
(关于第4小问的知识点：直接映射方式下主存地址被分为3段，分别是主存字块标记、Cache字块地址、字块内地址，因为Cache共有$2^6$个字块，所以Cache字块地址为6位；因为每个字块有$2^6$字节，所以字块内地址为6位，又主存总共位数为19位，所以主存字块标记为7位)

4.Cache的命中率

5.Cache的基本结构：存储体、地址映射变换部件、Cache替换机构

#### 第五章、输入输出系统

##### 一、概述

1.发展概况

(1)早期阶段
(2)接口模块和DMA阶段
①采用总线连接，连线简单，增减改设备容易
②I/O设备通过接口模块和主机相连，接口中有数据通路和控制通路，还能处理中断请求，使I/O设备与CPU并行工作
③接口技术可以使多个设备分时占用总线，实现设备之间并行工作
④CPU和I/O设备两种并行工作方式：中断方式和DMA方式
(中断方式在主机和外设交换信息时，CPU要中断现行程序；DMA方式使得CPU在I/O设备与主存交换信息时能继续完成自身工作，比中断方式进一步提高了CPU的工作效率)
(3)具有通道结构的阶段
(4)具有I/O处理机的阶段

2.输入输出系统的组成

(1)I/O系统由I/O软件和I/O硬件两部分组成
①I/O软件：输入输出系统主要任务是把用户程序、数据输入主机；把运算结果输送给用户；实现输入输出系统和主机工作的协调
②I/O硬件：带有接口的I/O系统一般包括接口模块和I/O设备两大部分

3.I/O设备与主机的联系方式

(1)I/O设备编址方式：统一编址、不统一编址
(2)设备寻址
(3)传送方式：串行、并行
(4)联络方式：立即响应方式、异步工作采用应答信号方式
(5)I/O设备与主机的连接方式：
①辐射式连接：每台设备配有一套控制线路，不便于增删设备，计算机发展早期模式
②总线连接：通过一组总线连接主机与所有设备，便于增删设备，现代计算机采用的连接方式

4.I/O设备与主机信息传送的控制方式

(1)程序查询方式：CPU和I/O串行工作，停止原来执行的程序，踏步等待
(2)程序中断方式：CPU和I/O并行工作，没有踏步等待现象，需中断现行程序
(3)DMA方式：CPU和I/O并行工作，I/O设备与主存直接交换信息，不占用CPU资源
(4)通道方式：通道是一个具有特殊功能的处理器
(5)I/O处理机方式：通道方式的进一步发展

##### 二、I/O设备

1.概述：①主机之外的大部分硬件设备都可以称为I/O设备，也称外设 ②I/O设备通过接口与主机相连
2.输入设备：键盘、鼠标、触摸屏
3.输出设备：显示器、打印机

##### 三、I/O接口

1.概述：I/O接口是主机与I/O设备之间设置的硬件电路及其相应的控制软件

2.功能：用于完成CPU和外设之间的数据交换

3.基本组成：包括硬件电路和软件编程两部分

##### 四、程序查询方式

1.程序查询流程
(1)查询流程
<img src="https://s2.loli.net/2023/07/31/sbBEHumhJ9WoPzZ.png" alt="image-20230604214241208" style="zoom: 50%;" />
(2)程序流程

##### 五、程序中断方式

1.I/O中断的产生：在外设做准备时，CPU继续执行现行程序，在外设准备就绪并提出中断请求之后，就暂时中断现行程序，转入执行I/O服务程序，这就产生了I/O中断

2.中断
(1)概念：计算机执行程序过程中，若出现异常情况或特殊请求，则计算机转向对异常情况或者特殊请求的处理，这通过运行中断服务程序实现
(2)作用：中断机制提高计算机系统的效率和效能
(3)原因：
①低速外设就绪后提出中断请求
②应付突发事件的需要
③实时控制中响应外来信号、可靠性等需要
④软件中断指令引起的中断

3.程序中断方式的接口电路

(1)配置中断请求触发器INTR和中断屏蔽触发器MASK
①INTR：状态为1表示提出中断请求
②MASK：状态为1表示封锁中断源的请求

(2)排队器

(3)中断向量地址形成部件
①CPU响应I/O中断后，要暂停现行程序，转去执行设备的中断服务程序，因此首先要找到该设备服务程序的入口地址
②入口地址寻找方法包括硬件法和软件法，硬件向量法就是通过向量地址寻找设备中断服务程序入口地址，而向量地址由硬件电路产生
③中断向量地址形成部件在排队器之后，排队器的输出是地址形成部件的输入，地址形成部件的输出是一串二进制代码，即中断向量。每个中断源对应一个向量地址，因此该部件是一个编码器。

4.I/O中断处理过程

(1)CPU响应中断的条件和时间
①条件：CPU中的允许中断触发器EINT=1，I/O本身有请求又未被屏蔽
②时间：当D=1且MASK=0时，在每条指令执行阶段的结束时刻，CPU发中断查询信号（将INTR置1）

(2)一次完整的中断处理过程：中断请求->中断判优->中断响应->中断服务->中断返回

5.中断服务程序流程

(1)中断服务程序的流程：
①保护现场：程序断点地址的保护、寄存器内容的保护
②中断服务：对不同的I/O设备具有不同内容的设备服务
③恢复现场：出栈或者读存储器指令
④中断返回：返回到原程序断点处，继续执行原程序

(2)单重中断和多重中断
①概念：计算机处理中断过程中，有可能出现新的中断请求，若CPU暂停执行现行中断服务程序，转去处理新的中断请求，称为多重中断或中断嵌套；若对新中断不予理睬，则为单重中断
②嵌套前提：只有优先级更高的新中断才能中断服务程序，且只有在EINT=1时才可以
③单重中断和多重中断在中断服务程序流程方面存在区别：开中断的时刻不同

(3)单重中断与多重中断的服务流程
<img src="https://s2.loli.net/2023/07/31/5tUTJeM93r6WROV.png" alt="image-20230606162508961" style="zoom: 67%;" />
(注意到开中断的位置区别就行)

##### 六、DMA方式

1.DMA方式的特点：DMA接口和主存之间存在直接数据通路，主存和设备交换信息不需要CPU暂停执行原程序为设备服务，省去了保护和恢复现场，工作速度比中断方式高

2.由于DMA接口和CPU共享主存，会出现两者竞争主存的冲突，因此需要分时使用主存（中断方式设备不能直接访问主存，因此没有和CPU竞争主存）
①停止CPU访问主存 ②周期挪用 ③DMA和CPU交替访问

3.DMA接口部件：①主存地址寄存器AR ②字计数器WC ③主存缓冲寄存器BR ④DMA控制逻辑 ⑤中断机构 ⑥设备地址寄存器DAR

4.DMA数据传送过程（预处理、数据传送、后处理）
(1)预处理：CPU用几条输入输出指令为DMA接口预置信息，即初始化，之后CPU继续执行主程序
(2)数据传送
(3)后处理：CPU执行中断服务程序，做DMA结束处理，之后CPU继续执行主程序

#### 第六章、计算机运算方法

##### 一、无符号数和有符号数

1.无符号数
计算机中参与运算的数都放在寄存器，寄存器的位数即机器字长（机器字长反应无符号数的表示范围）

2.有符号数
(1)机器数与真值
真值：带符号的数（手写）
机器数：符号数字化的数（存储）

(2)原码
符号位：0表示正数，1表示负数
数值位：是真值的绝对值

(3)补码

> 补数：一个负数加上模即得该负数的补数

符号位：0表示正数，1表示负数
数值位：对于正数不变；对于负数每位取反，末位加1

(4)反码
符号位：0表示正数，1表示负数
数值位：对于正数不变；对于负数每位取反、

(5)移码（和补码唯一的区别是符号位是1表示正数，0表示负数）

##### 二、数的定点表示和浮点表示

1.定点表示：小数点固定在某一位置（即上面的表示方法）

2.浮点表示：小数点位置可以浮动

(1)表示方法：$N=S\times r^j$
($S$为尾数，$j$为阶码，$r$为基数；其中S纯小数、可正可负，$j$整数、可正可负，一般取2、4、8、16$\cdots$)

(2)浮点数（在机器中）的表示形式
<img src="https://s2.loli.net/2023/07/31/6oiXdlCkKpeAtZh.png" alt="image-20230606214031771" style="zoom: 50%;" />

(3)表示范围
①上溢：阶码＞最大阶码
②下溢：阶码＜最小阶码

> 机器零：
> ①当浮点数 尾数为 0 时，不论其阶码为何值，按机器零处理
> ②当浮点数 阶码等于或小于它所表示的最小数时，不论尾数为何值，按机器零处理

##### 三、定点运算

1.移位

(1)移位运算：是数相对于小数点来说，所以左移绝对值扩大，右移绝对值减小

(2)算术移位规则
<img src="https://s2.loli.net/2023/07/31/dkuEz6xs3GZnFc1.png" alt="image-20230607114213057" style="zoom: 50%;" />

(3)算术移位和逻辑移位的区别
①算术移位：有符号数的移位
②逻辑移位：无符号数的移位

2.加减法

(1)补码加减法
①加法：$[A]_补+[B]_补=[A+B]_补$（连同符号位一起相加，符号位产生的进位自然丢掉）
②减法：$[A]_补+[-B]_补=[A-B]_补$

(2)溢出判断：
①一位符号位判断溢出
②两位符号位判断溢出：00表示正，11表示负，结果的双符号位相同则未溢出，结果的双符号位不同则溢出，最高符号位代表其真正的符号

##### 四、浮点运算

1.浮点加减运算

(1)对阶：求阶差，小阶向大阶看齐，保证尾数是纯小数，小阶浮点数的尾数右移次数等于阶差

(2)尾数求和/差：加法则尾数求和，减法则尾数求差

(3)规格化

- 规格化数的定义：$r=2，\frac{1}{2}\le|S|<1$

- 规格化数的判断：
  a.原码：不论正数、负数，第一位数为1
  b.补码：符号位和第一数位不同
  (未来便于硬件判断，对S<0的情况规定了两个特例：$[-\frac{1}{2}]_补$不是规格化的数，$[-1]_补$是规格化的数)

- 规格化操作规则：
  ①当尾数(补码)求和出现：00.0xxxx或者11.1xxxx时，意味着：尾数是纯小数，但是小数点后第一位是0，需要左规格化
  ②当尾数(补码)求和出现：01.xxxxx或者10.xxxxx时，这实质上是两个尾数的和超过1，产生溢出，意味着：尾数不是纯小数，小数点左面整数位是1，需要向右规格化（对于定点小数，就是溢出）

- 左规和右规
  左规：尾数每左移1位，阶码减1，直到数符和第一数位不同
  右规：尾数右移1位，阶码加1

(4)舍入（一般不会用到，但需考虑）

(5)溢出判断
阶码补码为01,xxx是上溢出，做中断溢出处理；阶码补码为10,xxx是下溢出，按机器零处理

#### 第七章、指令系统

##### 一、机器指令

1.基本概念

(1)机器语言：计算机解题直接用的语言，由一条语句组成
(2)机器指令：每一条机器语言的语句，具有准确的语义
(3)指令系统：全部机器指令的集合，集中描述了机器的功能，反映了计算机内部的数据类型、寄存器-存储器结构

2.指令的一般格式
<img src="https://s2.loli.net/2023/07/31/gYvpGKtFqEn7acs.png" alt="image-20230607210628565" style="zoom: 67%;" />

(1)操作码：指出机器所做操作，位数反映种类，n位操作码能表示$2^n$种操作

扩展操作码技术：操作码的位数随地址数的减少而增加
<img src="https://s2.loli.net/2023/07/31/hTnRPjbAiaBVSK2.png" alt="image-20230609195845189" style="zoom: 60%;" />

(2)地址码：指出操作数地址及下条指令地址（用硬件资源或寄存器承担地址码可缩短指令字长、减少访存次数）

3.指令字长：取决于操作码的长度、操作数地址的长度、操作数地址的个数

(1)指令字长固定：控制方式简单，早期采用方式；指令字长等于存储字长，取指令只需一次访存

(2)指令字长可变：控制电路复杂，多字长指令取指要多次访存

##### 二、操作数类型和操作种类

1.操作数类型：
①地址：无符号整数
②数字：定点数、浮点数、十进制数
③字符：表示文本或字符串
④逻辑数：多位0和1的组合都被看做逻辑数

2.操作类型：数据传送、算术逻辑操作、移位、转移、输入输出

##### 三、寻址方式

1.指令寻址：顺序寻址和条约寻址

2.数据寻址
(指令的地址码字段通常都不代表操作数的真实地址，故它称为形式地址)

(1)立即寻址：形式地址是操作数本身
(2)直接寻址：形式地址是操作数的真实地址
(3)隐含寻址：操作数的地址隐含在操作码或某个寄存器中
(4)间接寻址：形式地址指出操作数有效地址所在的存储单元地址
(5)寄存器寻址：形式地址直接指出寄存器的编号
(6)寄存器间接寻址
(7)基址寻址：设有基址寄存器BR，用形式地址与BR内的内容相加表示操作数的有效地址

- 因为形式地址的位数通常小于指令字长，而存储字长可与指令字长相等，所以间接寻址与直接寻址相比扩大了操作数的寻址范围。若设指令字长和存储字长均为16位，形式地址为8位，则直接寻址范围为$2^8$，而间接寻址范围为$2^{16}$。当多次间接寻址时，可用存储字的首位来标志间接寻址是否结束，所以寻址范围为$2^{15}$ 

##### 四、指令格式设计

1.主要内容
<img src="https://s2.loli.net/2023/07/31/TqLyUQAYBlViGv5.png" alt="image-20230609200040841" style="zoom: 50%;" />

2.设计思路
①操作码（OP）位数：由指令数\操作数确定，n位操作码对应$2^n$条指令
②寻址特征（M）位数：由寻址方式个数确定，n位寻址特征对应$2^n$个寻址方式
③形式地址（A）位数：由寻址空间决定，n位形式地址对应$2^n$直接寻址范围
④若遇到多地址指令，形式地址多个即可

#### 第八章、CPU的结构和功能

##### 一、CPU的结构

1.CPU的功能
(1)控制器的功能：取指令、分析指令、执行指令
(2)运算器的功能：实现算术运算和逻辑运算

2.CPU结构框图
3.CPU寄存器
4.控制单元CU和中断系统

##### 二、指令周期

1.指令周期的基本概念

(1)指令周期：取出并执行一条指令所需的全部时间，可简单分为取指周期、执行周期两个阶段
①取指周期 执行周期
②取指周期 间址周期 执行周期（带有间接寻址的）
③取指周期 间址周期 执行周期 中断周期（带有中断周期的）

2.指令周期的数据流

##### 三、中断系统

1.概述

(1)引起中断的各种因素：人为设置的中断、程序性事故、硬件故障、I/O设备、外部事件

(2)中断系统需解决的问题
方法：在中断系统中配置相应的软件和硬件

2.中断请求标记和中断判优逻辑

(1)中断请求标记：用于标记提出中断请求的中断源
给每个中断源设置一个中断请求标记触发器INTR，多个INTR组成中断标记寄存器

(2)中断判优逻辑

- 硬件实现（排队器）
  ①分散在各个中断源的接口电路中（链式排队器）
  ②集中在CPU内

- 软件实现（程序查询）

3.中断服务程序入口地址的寻找

(1)硬件向量法：硬件产生向量地址，再由向量地址找到中断服务程序入口地址

(2)软件查询法：中断判优排队和寻找ISR入口地址同时完成（速度慢于硬件向量法）
(软件查询的程序，也实现了中断请求排队)

4.中断响应

(1)响应中断的条件：允许中断触发器EINT=1，且有中断请求

(2)响应中断的时间：指令执行周期结束时刻由CPU发查询信号

(3)中断隐指令

①保护程序断点：断点存于存储器特定单元，或者断点进栈
②寻找服务程序入口地址（即上述三）
③硬件关中断：中断响应期间禁止再次响应中断

5.保护现场和恢复现场

(1)保护现场
①保护断点：中断隐指令完成
②保护寄存器内容：中断服务程序完成

(2)恢复现场：把寄存器内容恢复到中断处理前的状态，由中断服务程序完成

6.中断屏蔽技术（用于多重中断）

(1)多重中断的概念

(2)多重中断的条件
①提前设置开中断指令，在保护现场之后立即开中断
②优先级别高的中断源有权中断优先级别低的中断源

(3)屏蔽技术：保证低级别中断源不干扰高级别中断源的处理过程

①屏蔽触发器的作用

②屏蔽字：每个INTR对应一个屏蔽触发器，其全体组成一个屏蔽寄存器，屏蔽寄存器的内容称为屏蔽字。响应某个中断时，应该安排其对应的屏蔽字，以屏蔽某些中断源的请求。
(屏蔽字设置见https://blog.csdn.net/HeatDeath/article/details/73612269)

屏蔽字的原则：屏蔽位置0为处理级别高于自己的中断

③屏蔽技术可改变处理优先级
响应优先级：不可改变（排队器硬件决定）
处理优先级：可改变（重新设置屏蔽字）

==画图：==![image-20230609171254762](https://s2.loli.net/2023/07/31/xKFH2OifNLtzvRI.png)
④屏蔽技术的其他作用：可以人为的屏蔽某个中断源的请求，便于程序控制

(4)多重中断的断点保护（中断隐指令完成）
①断点可以进栈，先进后出
②断点也可以存入特定存储单元

##### 四、指令流水

1.如何提高机器速度
①提高访存速度
②提高I/O和主机之间信息传送速度
③提高运算速度

2.系统的并行性

(1)并行的概念
①并发：两个或两个以上事件在同一时间段发生
②并行：两个或两个以上事件在同一时刻发生

(2)并行性的等级
①过程级：粗粒度  软件实现
②指令级：细粒度  硬件实现

3.指令流水原理

(1)指令的串行执行：一段时间内只处理一条指令![image-20230609190159598](https://s2.loli.net/2023/07/31/HAf2UB57NzcKDso.png)(取指令由取指令部件完成，执行指令由执行指令部件完成，总有一个部件空闲)

(2)指令的二级流水：两类部件同时处理两条指令
<img src="https://s2.loli.net/2023/07/31/hKb84lmwGEuCsP9.png" alt="image-20230609190306148" style="zoom: 67%;" />
(若取指和执行阶段时间上完全重叠，指令周期减半，速度提高一倍)

(3)影响指令流水效率加倍的因素
①执行时间大于取指时间
②条件转移指令对于指令流水的影响

4.流水线性能

(1)吞吐率：单位时间内流水线所完成指令或输出结果的数量
(最大吞吐率：流水线连续流动达到稳定状态)

设对于$m$段的指令流水线，若各段的时间为$\Delta t$，则最大吞吐率为$T_{pmax}=\frac{1}{\Delta t}$

连续处理$n$条指令的吞吐率为$T_p=\frac{n}{m\cdot\Delta t+(n-1)\cdot\Delta t}=\frac{T_{pmax}}{1+(m-1)/n}$

(2)加速比$S_p$：流水线的速度与等功能的非流水线的速度之比$S_p=\frac{m}{1+(m-1)/n}$

(3)效率：流水线中各功能段利用率$E=T_P\Delta t$





#### 第九章、控制单元的功能

##### 一、微操作命令的分析

1.指令周期的四个阶段
(1)取指周期：取指令过程
(2)间址周期：完成取操作数
(3)执行周期：执行指令，不同指令的执行周期微操作不同
(4)中断周期：存程序断点

##### 二、控制单元的功能

> 控制单元的功能就是发送控制信号，控制完成取指和执行过程中的各种微操作

1.外特性

(1)输入信号：时钟、指令寄存器、标志、外来信号
(2)输出信号：CPU的各种控制信号、送至控制总线给其他部件的信号

2.控制信号举例

3.多级时序系统

(1)机器周期
①概念：所有指令执行过程中的一个基准时间
②考虑因素：每条指令的执行步骤，每一步骤的所需时间
③基准时间的确定：
以完成最复杂指令功能的时间为基准
以访问一次存储器额的时间为基准

(若指令字长=存储字长，则取指周期=机器周期)==（未理解）==

(2)时钟周期（节拍、状态）
①可用时钟信号控制产生每一个微操作命令
②讲一个机器周期分成若干相等的时间段
③时钟周期是控制计算机操作的最小单位时间
④在每个时钟周期，可完成一个或几个需要同时进行的微操作

(3)多级时序系统
①机器周期、节拍组成多级时序系统
②一个指令周期包含若干个机器周期,一个机器周期包含若干个时钟周期

(4)关系总结

①机器速度与及其主频的关系

- 机器的主频$f$越快，机器的速度也越快
- 机器速度不仅与主频有关，还与指令周期所含机器周期数、机器周期所含时钟周期数有关

②互为倒数：
指令周期与平均指令执行速度
时钟周期与主频

③指令周期、机器周期和时钟周期的关系
![时钟周期、机器周期与指令周期- 知乎](https://s2.loli.net/2023/07/31/FCKGy9A6VtkWjHo.webp)

(5)控制方式==（不考）==

> ①由于每条指令对应的微操作个数以及复杂程度不同，因此每条指令和每个微操作所需的时间也不同
> ②控制不同微操作序列所采用的的时序控制方式也不一样

①同步控制方式：任一微操作的执行事先确定，均由同一基准时标的时序信号控制

- 采用定长的机器周期：以最长的微操作序列和最繁的微操作作为标准，机器周期内时钟周期数相等
- 采用不定长的机器周期：机器周期内时间周期数不相等（具体可见上图）
- 采用中央控制和局部控制相结合的方法：大部分指令安排在统一的、较短的机器周期内完成，称为中央控制；极少数操作复杂的指令中的某些操作采用局部控制的方式完成

②异步控制方式：无基准时标信号，无固定的周期节拍和严格的时钟同步，采用应答方式

③联合控制方式：同步与异步相结合

④人工控制方式：Reset -> 连续或单条指令执行转换开关 -> 符合停机开关

#### 第十章、控制单元的设计

1.组合逻辑控制单元框图
(1)CU外特性：把指令译码器和节拍发生器从控制单元分离出来
(2)节拍信号

2.微操作的节拍安排

(1)CU采取同步控制方式形成位操作序列，一个机器周期内有三个节拍(时钟周期)，CPU内部采取非总线方式

(2)安排微操作时序的原则
①未操作的先后顺序不得所以更改
②被控对象不同的微操作尽量安排在一个节拍内完成
③占用时间较短的微操作，尽量安排在一个节拍内完成，并允许有先后顺序

==补充：==
==1KB=$2^{10}$字节、1个字节=8位、1个字等于多少个字节由位数决定==
==对于存储器来说有$2^n$字节容量，则其地址为n位==

